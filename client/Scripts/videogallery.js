const VIDEO_TITLES = [
`9hab arabe sex amateur`,
`Abella Danger - Big Butt Teen Ass Fucked`,
`Abigail Mac, A Domestic Dicking`,
`Adria Rae - Daddy’s Debt`,
`Aidra Fox, Unexpected Dinner Guest`,
`Aj  Angela Lesbian Love`,
`Alanah Rae - Ten Dollar Whore`,
`Alexis Fawx - Let Mommy Help You`,
`Alli Rae, Brandi Love, Kimmy Granger - The Wild Card`,
`An Inconvenient Mistress - Angela White`,
`Angel-White-MILF-BBC-Hookup`,
`Angela White  Violet Myers - BBC Sharing`,
`Angela White , Gia Derza`,
`Angela White - I Waited For You`,
`Angela White - Nice Friends You Have, Mom - Latest XXX 2024`,
`Angela White - Up Inside Angela's Tightest Hole 2`,
`Angela White - Your Woman Has Needs, Dad!`,
`Angela White Bouncing Back`,
`Angela White In Her First Gangbang`,
`Angela White Triple Penetrated`,
`Angela White Vs Mandingo`,
`Angela White X Mandingo BBC Upscaled 4k`,
`Angela White hot and sexy milf`,
`Angela White latest bbc porn video`,
`Angela White-  angela white lips meet for the first time`,
`Angela White- full service banking`,
`Annabel Redd - Step Brother`,
`Annie Archer nerd girl use bbc for first time`,
`Aranic firi womens sex`,
`Audrey Bitoni - Horny wife fucked by her husband’s friend`,
`Audrey Bitoni - I Locked The Door`,
`Ava Addams - Unfaithful Wife Punished`,
`Ava Addams, Daisy Summers - Step Daughter And Step Mom`,
`BLACKED BIG  NATURAL COMPILATION`,
`Bailey Brooke - My Sister’s Hot Friend`,
`Battle For Big Breast Dominance - Angela White - EPORNER`,
`Bellesa House - Busty Babe Angela White Loves everything about Mick Blue & can't Wait to Fuck him - Pornhub.com`,
`Big Tits Milf Love BBC Anal`,
`Blair Williams - I Can Do Anal Though`,
`Busty Angela White Gets Fucked by Step-Son, S01EP06 (720)`,
`Busty Japanese Secretary`,
`Carmela Clutch - Take Over The Car Accident`,
`Cassidy Klein, Chanel Preston, The Wettest Dream`,
`Cassidy Klein, Veronica Vain - The Day For Giving Thanks`,
`Celebration! ! Commemorative Work That Breaks Through 50 Ripe Comics! ! Up And Coming Mature Woman Humiliation! ! Original  Koshiyama Weakness Married Nampa Ntr Hot Spring`,
`Chanel Preston - Her First Big Sale 2`,
`Chanel Preston - Stepmoms Special Frosting`,
`Chanel Preston, Kristina Rose, Phoenix Marie - New Years Eve Party`,
`Cum In Me, Not On My Couch`,
`Cytherea, Blind Experiment`,
`Dakota Skye - Don’t Fuck My Brother, Bitch!`,
`Dani Daniels - Romantic Aggression 2, Scene 1`,
`Dani Daniels, He Says, She Fucks`,
`Darkside Intense Anal Sex with BBC - Angela white`,
`Dirty With Father In Law, American Wife's Body Lovejoy - Megu Fujiura`,
`Dylan Phoenix Molly Jane, Big Tits On The Bottom Bunk`,
`Ella huges Shy Redheads Want Anal`,
`Esperanza Gomez - I Take Out My Cock In Stepmom's Car`,
`Eva Notty - His Friend’s Mom`,
`Eva Notty - Mom’s In Hot Water`,
`Eva Notty - Pizza Party- Part 1`,
`Eva Notty Milf Squad Vegas_ The Stakeout`,
`Eva Notty, Gia Paige, Prom Pussy`,
`Eva Notty, There Goes The Neighborhood Scoundrel`,
`Gabbie Carter - Desirable Brunette Gets Licked And Penetrated`,
`Gabbie Carter - Sexy Blonde Fucked By The Big Black Cock`,
`Gabbie Carter - pit-stop for an iced coffee`,
`Gabbie Carter, LaSirena69 - Lucky Guy`,
`Gabbie Carter, LaSirena69 - Perfect Wife`,
`Gabriela Lopez - Lopez Family Vacation`,
`Gia Paige - I’m Not Leaving!`,
`Girlsway Obsessed With Pussy`,
`Holly Hendrix, Mandy Muse - My Girlfriend’s Phat Ass Roommate`,
`In Egyptian Brothel`,
`Interracial Double Penetration`,
`Isabella De Santos - Hot Anal Latina`,
`It's Too Cute For`,
`JJ Angela White`,
`JJ cumshot compilation (1080)`,
`Japanese Wife Fucked All Day In Front Of Her Husband_`,
`Jasmine James - Jasmine’s At The Laundromat`,
`Jayden Jaymes - Big Twits in Uniform- He Comes to America!`,
`Jayden Jaymes - I Won’t Tell The Boss`,
`Julianna Vega, Mia Khalifa - Stepmom and Step-daughter`,
`Jynx Maze - Jynx’s Juicy Pussy`,
`Keisha Grey - Don’t Touch Her 2`,
`Keisha Grey - Trying to get her professor’s attention`,
`Keisha Grey, Leah Gotti - Best Friends Share Everything`,
`Keisha Grey, Mandy Muse - Step-Sister’s Play Tug of War With Boyfriend`,
`Kelsi Monroe - Banging That Hot Pussy`,
`Kelsi Monroe - Kelsi Meets Mandingo`,
`Kendra Lust - Big Tit MILF Star Kendra Lust Has A BBC Celebration With Dredd`,
`Kianna Dior - Your MILF is the Best`,
`Kimmy Granger - Don’t Forget To Fuck!`,
`Kimmy Granger, Adriana Chechik - class for a hands-on demonstration `,
`King Louie 5`,
`King Louie 6`,
`King Louie 9`,
`King louie 2`,
`LIKE WE'RE STILL TOGETHER`,
`Lauren Phillips - Busty Redhead MILF At Prison`,
`Lena Paul - Hot Stepmom`,
`Lena Paul - Longtime Best Friend`,
`Lennox Luxe Blacked`,
`Lilly Ford - Father’s Day Movie Night Surprise`,
`Mandy Flores - Flirty Sister Learns A Lesson`,
`Mandy Muse - Mandy’s Anal Amusement`,
`Mea Melone - Lost In ZZ Episode 4`,
`Melissa May Romi Rain, Room, Board and Bang`,
`Mia Evans, Missy Luv - Snowballing Stepsister Secrets`,
`Mia Khalifa - Horny, First Threesome With Big Black Cocks`,
`Mia Khalifa - Quarterback sneak on that College pussy`,
`Mia Malkova - My Own Private Tryout`,
`Mia Malkova, Natalia Starr - Let’s Have a Threesome`,
`Molly Jane - You’re married`,
`My Wife's Fav Resort`,
`My Younger Brother's Wife My Younger Brother's Wife Who Can't Refuse Sex (Misuzu Takeuchi)`,
`Natasha Nice - Wealthy Widow`,
`Nicole Aniston, The Perfect Maid 2`,
`Nika Venom - Curvy Babe Needs Creampie`,
`Nina North - The Make Up Exam`,
`Our New Maid- Part One`,
`Passion Sex`,
`Personal Trainers- Session 3`,
`Peta Jensen - Big Boob Secretary Does Her Black Boss`,
`Porn Habits`,
`REMY LA CROIX (2)`,
`Rasha and Rajab and the best nick`,
`Remy BOB`,
`Remy L. Anal`,
`Remy La Croix Young  Glamorous`,
`Remy La Croix`,
`Remy Lacroix - 2`,
`Remy Lacroix - Anal Hula Hoop`,
`Remy Lacroix`,
`Riley Nixon - Cant Get Enough`,
`Riley Reid, Eva Lovia - Sluts In Stockings`,
`Riley Takes Monster Dick In Her Ass`,
`Rion Izumi Gets Pounded Like A Bitch In Front Of Her Daughter`,
`Romi Rain - Romi Rains In A BBC`,
`Rose Monroe - Staycation Sex Blues`,
`Ryan Smiles, The Replacement`,
`STARS-947 A Beautiful Wife Who Runs A Vacation Rental I`,
`Samantha Saint, The Perfect Maid 3`,
`Sara Jay - Bring Me The Manager`,
`Scarlet Red - Back for 2 Big Black Dicks`,
`She In Trouble LOL`,
`She wants his black cock!`,
`Sheena Ryder - Sheena In Stepmom Fucks Her Two Sons`,
`Sienna West - Sexy Teacher`,
`Siri Dahl - Sweet Dinner For My Stepson`,
`Skylar Vox, LaSirena69 - It Was The Fucking Realtor`,
`Sone385 Uncensored Boobs Ass (1080)`,
`Stay Away From My Daughter`,
`Sunny Lane, The Masturbating Teacher`,
`Sybil Stallone - Stepmom’s Spring Cleaning`,
`Tessa Lane - interracial`,
`Tessa Lane 1`,
`Tessa Lane Hiding`,
`Tessa Lane`,
`The Break-Up`,
`The Cuckold Compilation BLACKED`,
`This Is What It Sounds Like When Moms Fuck`,
`Tiny Bookworm Step Sister tries Sex - Kylie Quinn - Family Therapy - Alex Adams - Pornhub.com`,
`Two Big Tits Milf Share A BBC 2024 Ofleak - Angela White And Violet Myers`,
`Valentina Nappi - I’m Horny - Call an Ambulance!`,
`Valerie Kay - Hard Dick`,
`Valerie Kay - Valerie Kay Saves the Day`,
`Violet Myers - Double Penetration`,
`Violet Myers - Playing With My Latina Friend`,
`Violet Starr - No Fucking Spoilers`,
`Violet Starr, Vanessa Sky - Spa night turns into a hardcore anal threesome`,
`Watch BLACKED Iconic Gabbie Compilation - Anal, Blonde, Blowjob Porn - SpankBang`,
`Watch Lesbian Analingus - Milf, Blonde, Big Ass Porn - SpankBang`,
`Watch Riley Reid_ My Personal Porn Star Plaything for the Night - Fan, Hotel, Client Porn - SpankBang`,
`Watch Riley Reid_s Academic Ambition_ Sucking and Fucking Her Way to Success - Sexy, Petite, College Porn - SpankBang`,
`White Ass`,
`angela white horny wet pussy`,
`angela white no script for huge tits angela`,
`arabic sex`,
`hot caretaker that takes ups a coach after her duty`,
`it's too big`,
`ragab mohamedy`,
`stepMomsTeachSex - Stepmom & Stepson Share Bed & Fuck S7_E3`,
];

function showPage(pageId) {
        const pages = document.querySelectorAll('.page');
        pages.forEach(page => {
            page.classList.remove('active');
        });
        document.getElementById(pageId).classList.add('active');
    }
    
const videos = VIDEO_TITLES.map((title, index) => ({
  id: `video-${index + 1}`,
  title,
  duration: `${Math.floor(Math.random() * 10) + 1}:${String(Math.floor(Math.random() * 60)).padStart(2, '0')}`,
  src: `/Assets/videos/${encodeURIComponent(title)}.mp4`,
  thumbnail: `/Assets/thumb/${encodeURIComponent(title)}_thumb_001.jpg`, // <-- FIXED
  watched: Math.random() > 0.7,
  lastWatched: Math.random() > 0.5 ? new Date(Date.now() - Math.random() * 7 * 24 * 60 * 60 * 1000).toISOString() : undefined,
  progress: Math.random() * 100
}));

let currentVideo = videos[0];

const videoPlayer = document.getElementById('video-player');
const videoSource = document.getElementById('video-source');
const videoTitle = document.getElementById('video-title');
const videoInfo = document.getElementById('video-info');
const videoList = document.getElementById('video-list');
const videoCount = document.getElementById('video-count');
const searchInput = document.getElementById('search');
const filterSelect = document.getElementById('filter');

let viewMode = 'grid';

function formatDate(dateStr) {
  const date = new Date(dateStr);
  return date.toLocaleDateString();
}

// Add a sort select element (call this after DOMContentLoaded or add to your HTML)
const sortSelect = document.createElement('select');
sortSelect.id = 'sort';
sortSelect.innerHTML = `
  <option value="alpha">Alphabetical</option>
  <option value="random">Random</option>
  <option value="recent">Recently Watched</option>
  <option value="mostviewed">Most Viewed</option>
`;

// Restore last sort from localStorage or default to 'alpha'
const lastSort = localStorage.getItem('video-sort') || 'alpha';
sortSelect.value = lastSort;

videoCount.parentNode.insertBefore(sortSelect, videoCount.nextSibling);

sortSelect.addEventListener('change', () => {
  localStorage.setItem('video-sort', sortSelect.value);
  renderVideoList();
});

function renderVideoList() {
  const searchTerm = searchInput.value.toLowerCase();
  const filter = filterSelect.value;
  const sort = sortSelect.value;

  let filtered = videos.filter(video => {
    const matchesSearch = video.title.toLowerCase().includes(searchTerm);
    const matchesFilter =
      filter === 'all' ||
      (filter === 'watched' && video.watched) ||
      (filter === 'unwatched' && !video.watched);

    // Exclude the currently playing video from the list
    const notPlaying = !currentVideo || video.id !== currentVideo.id;
    return matchesSearch && matchesFilter && notPlaying;
  });

  // Sorting logic (duration removed)
  if (sort === 'random') {
    filtered = filtered.slice().sort(() => Math.random() - 0.5);
  } else if (sort === 'recent') {
    filtered = filtered.slice().sort((a, b) => {
      if (!a.lastWatched) return 1;
      if (!b.lastWatched) return -1;
      return new Date(b.lastWatched) - new Date(a.lastWatched);
    });
  } else if (sort === 'mostviewed') {
    filtered = filtered.slice().sort((a, b) => {
      const aViews = getViewCount(a.title);
      const bViews = getViewCount(b.title);
      return bViews - aViews;
    });
  } else {
    filtered = filtered.slice().sort((a, b) => a.title.localeCompare(b.title));
  }

  videoList.innerHTML = filtered.map(video => {
    const thumb = `/Assets/thumb/${encodeURIComponent(video.title)}_thumb_001.jpg`;
    const views = getViewCount(video.title); // Get view count for this video
    // Get duration from localStorage (formatted)
    const duration = localStorage.getItem(`video-duration-formatted-${video.title}`) || '';
    return `
      <div class="video-card" onclick="selectVideo('${video.id}')">
        <img src="${thumb}" alt="${video.title}" onerror="this.onerror=null;this.src='https://via.placeholder.com/320x180?text=No+Thumbnail';" />
        <div class="info">
          <h4>${video.title}</h4>
          <p>Duration: ${duration}</p>
          <p>Views: ${views}</p>
        </div>
      </div>
    `;
  }).join('');

  videoCount.textContent = `${filtered.length} videos in your collection`;

  // Setup hover animation for thumbnails
  setupVideoCardHoverAnimation();
}

// Helper to get view count from localStorage
function getViewCount(title) {
  return parseInt(localStorage.getItem(`video-views-${title}`) || '0', 10);
}

// Helper to increment view count in localStorage
function incrementViewCount(title) {
  const key = `video-views-${title}`;
  let count = getViewCount(title);
  count += 1;
  localStorage.setItem(key, count);
}

// Track if current video has passed 10s for view counting
let viewCountedForThisPlay = false;
let hasStartedPlaying = false;

// Only start counting after the user actually plays the video
videoPlayer.addEventListener('play', function() {
  hasStartedPlaying = true;
});

videoPlayer.addEventListener('pause', function() {
  hasStartedPlaying = false;
});

videoPlayer.addEventListener('timeupdate', function() {
  if (currentVideo && videoPlayer.currentTime > 0) {
    localStorage.setItem(
      `video-pos-${currentVideo.title}`,
      videoPlayer.currentTime
    );
  }

  // Count as a view only if played past 10 seconds, not already counted, and user has played the video
  if (
    currentVideo &&
    hasStartedPlaying &&
    !viewCountedForThisPlay &&
    videoPlayer.currentTime >= 10
  ) {
    incrementViewCount(currentVideo.title);
    viewCountedForThisPlay = true;
    renderVideoList();
    updateVideoInfo();
  }
});

// Reset viewCountedForThisPlay and hasStartedPlaying when a new video is loaded
videoPlayer.addEventListener('loadeddata', function() {
  viewCountedForThisPlay = false;
  hasStartedPlaying = false;
});

// Update video info panel with correct view count
function updateVideoInfo() {
  videoInfo.innerHTML = `
    <h3>${currentVideo.title}</h3>
    ${currentVideo.lastWatched ? `<p>Last Watched: ${formatDate(currentVideo.lastWatched)}</p>` : ''}
    <p>Views: ${getViewCount(currentVideo.title)}</p>
  `;
}

// Helper to get sorted and filtered videos (reuse your filtering/sorting logic)
function getSortedFilteredVideos() {
  const searchTerm = searchInput.value.toLowerCase();
  const filter = filterSelect.value;
  const sort = sortSelect.value;

  let filtered = videos.filter(video => {
    const matchesSearch = video.title.toLowerCase().includes(searchTerm);
    const matchesFilter =
      filter === 'all' ||
      (filter === 'watched' && video.watched) ||
      (filter === 'unwatched' && !video.watched);

    // Exclude the currently playing video from the list
    const notPlaying = !currentVideo || video.id !== currentVideo.id;
    return matchesSearch && matchesFilter && notPlaying;
  });

  if (sort === 'random') {
    filtered = filtered.slice().sort(() => Math.random() - 0.5);
  } else if (sort === 'recent') {
    filtered = filtered.slice().sort((a, b) => {
      if (!a.lastWatched) return 1;
      if (!b.lastWatched) return -1;
      return new Date(b.lastWatched) - new Date(a.lastWatched);
    });
  } else if (sort === 'mostviewed') {
    filtered = filtered.slice().sort((a, b) => {
      const aViews = getViewCount(a.title);
      const bViews = getViewCount(b.title);
      return bViews - aViews;
    });
  } else {
    filtered = filtered.slice().sort((a, b) => a.title.localeCompare(b.title));
  }
  return filtered;
}

// --- BEGIN: Your existing code (minus DOMContentLoaded wrappers) ---
const filtered = getSortedFilteredVideos();
  if (filtered.length > 0) {
    // Load the video but do not play it
    const vid = filtered[0];
    currentVideo = vid;
    videoSource.src = vid.src;
    videoPlayer.poster = vid.thumbnail;
    videoPlayer.load();
    videoTitle.textContent = vid.title;
    updateVideoInfo();

    // Restore last position and volume if available
    videoPlayer.onloadedmetadata = function() {
      const savedTime = localStorage.getItem(`video-pos-${vid.title}`);
      if (savedTime) {
        videoPlayer.currentTime = parseFloat(savedTime);
      }
      const savedVol = localStorage.getItem(`video-vol-${vid.title}`);
      videoPlayer.volume = savedVol !== null ? parseFloat(savedVol) : 0.03;
      videoPlayer.onloadedmetadata = null;
    };
  } else {
    videoSource.src = '';
    videoPlayer.poster = '';
    videoTitle.textContent = '';
    videoInfo.innerHTML = '';
  }

// When sorting changes, load (but do not play) the top video in the new sorting
sortSelect.addEventListener('change', () => {
  localStorage.setItem('video-sort', sortSelect.value);
  renderVideoList();
  const filtered = getSortedFilteredVideos();
  if (filtered.length > 0) {
    // Load the video but do not play it
    const vid = filtered[0];
    currentVideo = vid;
    videoSource.src = vid.src;
    videoPlayer.poster = vid.thumbnail;
    videoPlayer.load();
    videoTitle.textContent = vid.title;
    updateVideoInfo();

    videoPlayer.onloadedmetadata = function() {
      const savedTime = localStorage.getItem(`video-pos-${vid.title}`);
      if (savedTime) {
        videoPlayer.currentTime = parseFloat(savedTime);
      }
      const savedVol = localStorage.getItem(`video-vol-${vid.title}`);
      videoPlayer.volume = savedVol !== null ? parseFloat(savedVol) : 0.03;
      videoPlayer.onloadedmetadata = null;
    };
  }
});

// When a video is selected, save its id as the last played
window.selectVideo = function(id) {
  currentVideo = videos.find(v => v.id === id);
  videoSource.src = currentVideo.src;
  videoPlayer.poster = currentVideo.thumbnail;
  videoPlayer.load();
  videoTitle.textContent = currentVideo.title;
  updateVideoInfo();

  // Save last played video id
  localStorage.setItem('last-video-id', id);

  videoPlayer.onloadedmetadata = function() {
    // Restore position
    const savedTime = localStorage.getItem(`video-pos-${currentVideo.title}`);
    if (savedTime) {
      videoPlayer.currentTime = parseFloat(savedTime);
    }
    // Restore volume
    const savedVol = localStorage.getItem(`video-vol-${currentVideo.title}`);
    videoPlayer.volume = savedVol !== null ? parseFloat(savedVol) : 0.03;
    videoPlayer.onloadedmetadata = null; // Clean up
  };

  videoPlayer.scrollIntoView({ behavior: 'smooth', block: 'center' });

  // Display a random thumbnail from the thumbs folder for the current video
  function showRandomThumbnailForCurrentVideo() {
    const MAX_THUMBS = 20;
    let availableThumbs = [];
    for (let i = 0; i < MAX_THUMBS; i++) {
      const thumbPath = `/Assets/thumb/${encodeURIComponent(currentVideo.title)}_thumb_${i}.jpg`;
      availableThumbs.push(thumbPath);
    }
    const randomIndex = Math.floor(Math.random() * availableThumbs.length);
    const randomThumb = availableThumbs[randomIndex];

    let preview = document.getElementById('random-thumb-preview');
    if (!preview) {
      preview = document.createElement('img');
      preview.id = 'random-thumb-preview';
      preview.style.width = '160px';
      preview.style.height = '90px';
      preview.style.border = '2px solid #fff';
      preview.style.borderRadius = '8px';
      preview.style.background = '#222';
      preview.style.display = 'block';
      preview.style.margin = '10px auto';
      document.body.appendChild(preview);
    }
    preview.src = randomThumb;
    preview.style.display = 'block';
  }

  showRandomThumbnailForCurrentVideo();
};

// On page load, if a last played video exists, continue that video
window.addEventListener('DOMContentLoaded', function() {
  const lastId = localStorage.getItem('last-video-id');
  if (lastId && videos.some(v => v.id === lastId)) {
    window.selectVideo(lastId);
  } else {
    videoSource.src = '';
    videoPlayer.poster = '';
    videoTitle.textContent = '';
    videoInfo.innerHTML = '';
  }
});

searchInput.addEventListener('input', renderVideoList);
filterSelect.addEventListener('change', renderVideoList);



let preview = document.getElementById('timeline-thumb-preview');
if (!preview) {
  preview = document.createElement('img');
  preview.id = 'timeline-thumb-preview';
  preview.style.position = 'absolute';
  preview.style.display = 'none';
  preview.style.pointerEvents = 'none';
  preview.style.width = '160px';
  preview.style.height = '90px';
  preview.style.border = '2px solid #fff';
  preview.style.borderRadius = '8px';
  preview.style.background = '#222';
  preview.style.zIndex = 1000;
  document.body.appendChild(preview);
}

// Set your thumbnail interval here (in seconds)
const THUMB_INTERVAL = 60; // 60 for 1 minute, 5 for every 5 seconds, etc.

videoPlayer.addEventListener('mousemove', function(e) {
  const rect = videoPlayer.getBoundingClientRect();
  const y = e.clientY - rect.top;
  if (y < rect.height - 40) {
    preview.style.display = 'none';
    return;
  }

  // Calculate hovered time
  const x = e.clientX - rect.left;
  const percent = Math.min(Math.max(x / rect.width, 0), 1);
  const time = Math.floor(percent * videoPlayer.duration);

  // Find the closest thumbnail index (rounded down to nearest interval)
  const thumbIndex = Math.floor(time / THUMB_INTERVAL);
  const thumbSrc = `/Assets/thumb/${encodeURIComponent(currentVideo.title)}_thumb_${thumbIndex}.jpg`;

  preview.src = thumbSrc;
  preview.style.left = `${e.pageX - 80}px`; // Center the preview horizontally
  preview.style.top = `${rect.top - 100}px`; // Show above the player
  preview.style.display = 'block';
});

videoPlayer.addEventListener('mouseleave', function() {
  preview.style.display = 'none';
});

// Assumes videoPlayer is your <video> element
function generateThumbnailAt(timeInSeconds, callback) {
  const video = document.getElementById('video-player');
  const canvas = document.createElement('canvas');
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;

  // Seek to the desired time
  video.currentTime = timeInSeconds;

  video.onseeked = function() {
    const ctx = canvas.getContext('2d');
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    const dataURL = canvas.toDataURL('image/jpeg');
    callback(dataURL); // This is the thumbnail image as a base64 string
    video.onseeked = null; // Clean up
  };
}



// Initial load
window.selectVideo(currentVideo.id);
renderVideoList();

// Helper to get all available thumbnails for a video (adjust max as needed)
function getAllThumbsForVideo(videoTitle, maxThumbs = 10) {
  // Returns an array of thumbnail paths: _thumb_001, _thumb_002, ..., _thumb_00N
  const thumbs = [];
  for (let i = 1; i <= maxThumbs; i++) {
    const num = i.toString().padStart(3, '0');
    thumbs.push(`/Assets/thumb/${encodeURIComponent(videoTitle)}_thumb_${num}.jpg`);
  }
  return thumbs;
}

// Add this after your renderVideoList function
function setupVideoCardHoverAnimation() {
  document.querySelectorAll('.video-card').forEach(card => {
    card.onmouseenter = null;
    card.onmouseleave = null;
  });

  document.querySelectorAll('.video-card').forEach(card => {
    let thumbInterval = null;
    let thumbIndex = 0;
    const videoTitle = card.querySelector('h4').textContent;
    // Dynamically check how many thumbs exist for this video
    let thumbs = [];
    let i = 1;
    // Try up to 50 thumbs, stop at first missing image
    function checkThumbExists(url, cb) {
      const img = new window.Image();
      img.onload = () => cb(true);
      img.onerror = () => cb(false);
      img.src = url;
    }
    function loadThumbs(callback) {
      thumbs = [];
      let checkNext = function(idx) {
        const num = idx.toString().padStart(3, '0');
        const url = `/Assets/thumb/${encodeURIComponent(videoTitle)}_thumb_${num}.jpg`;
        checkThumbExists(url, exists => {
          if (exists) {
            thumbs.push(url);
            checkNext(idx + 1);
          } else {
            callback();
          }
        });
      };
      checkNext(1);
    }

    let thumbsLoaded = false;

    card.onmouseenter = () => {
      if (thumbInterval) clearInterval(thumbInterval);
      if (!thumbsLoaded) {
        loadThumbs(() => {
          thumbsLoaded = true;
          if (thumbs.length === 0) return;
          thumbIndex = 0;
          const img = card.querySelector('img');
          img.src = thumbs[thumbIndex];
          thumbInterval = setInterval(() => {
            thumbIndex = (thumbIndex + 1) % thumbs.length;
            img.src = thumbs[thumbIndex];
          }, 500);
        });
      } else {
        if (thumbs.length === 0) return;
        thumbIndex = 0;
        const img = card.querySelector('img');
        img.src = thumbs[thumbIndex];
        thumbInterval = setInterval(() => {
          thumbIndex = (thumbIndex + 1) % thumbs.length;
          img.src = thumbs[thumbIndex];
        }, 500);
      }
    };

    card.onmouseleave = () => {
      clearInterval(thumbInterval);
      thumbsLoaded = false;
      const img = card.querySelector('img');
      // Reset to the first thumb (or fallback)
      img.src = `/Assets/thumb/${encodeURIComponent(videoTitle)}_thumb_001.jpg`;
    };
  });
}

// Call this at the end of renderVideoList
function renderVideoList() {
  const searchTerm = searchInput.value.toLowerCase();
  const filter = filterSelect.value;
  const sort = sortSelect.value;

  let filtered = videos.filter(video => {
    const matchesSearch = video.title.toLowerCase().includes(searchTerm);
    const matchesFilter =
      filter === 'all' ||
      (filter === 'watched' && video.watched) ||
      (filter === 'unwatched' && !video.watched);

    // Exclude the currently playing video from the list
    const notPlaying = !currentVideo || video.id !== currentVideo.id;
    return matchesSearch && matchesFilter && notPlaying;
  });

  // Sorting logic (duration removed)
  if (sort === 'random') {
    filtered = filtered.slice().sort(() => Math.random() - 0.5);
  } else if (sort === 'recent') {
    filtered = filtered.slice().sort((a, b) => {
      if (!a.lastWatched) return 1;
      if (!b.lastWatched) return -1;
      return new Date(b.lastWatched) - new Date(a.lastWatched);
    });
  } else if (sort === 'mostviewed') {
    filtered = filtered.slice().sort((a, b) => {
      const aViews = getViewCount(a.title);
      const bViews = getViewCount(b.title);
      return bViews - aViews;
    });
  } else {
    filtered = filtered.slice().sort((a, b) => a.title.localeCompare(b.title));
  }

  videoList.innerHTML = filtered.map(video => {
    const thumb = `/Assets/thumb/${encodeURIComponent(video.title)}_thumb_001.jpg`;
    const views = getViewCount(video.title); // Get view count for this video
    // Get duration from localStorage (formatted)
    const duration = localStorage.getItem(`video-duration-formatted-${video.title}`) || '';
    return `
      <div class="video-card" onclick="selectVideo('${video.id}')">
        <img src="${thumb}" alt="${video.title}" onerror="this.onerror=null;this.src='https://via.placeholder.com/320x180?text=No+Thumbnail';" />
        <div class="info">
          <h4>${video.title}</h4>
          <p>Duration: ${duration}</p>
          <p>Views: ${views}</p>
        </div>
      </div>
    `;
  }).join('');

  videoCount.textContent = `${filtered.length} videos in your collection`;

  // Setup hover animation for thumbnails
  setupVideoCardHoverAnimation();
}

const video = document.getElementById('video-player');

video.addEventListener('loadedmetadata', function() {
  const durationInSeconds = video.duration;
  // Format as mm:ss if you want
  const minutes = Math.floor(durationInSeconds / 60);
  const seconds = Math.floor(durationInSeconds % 60).toString().padStart(2, '0');
  const formatted = `${minutes}:${seconds}`;
  console.log('Duration:', formatted);

  // Store duration in localStorage using the current video title as key
  if (currentVideo) {
    localStorage.setItem(`video-duration-${currentVideo.title}`, durationInSeconds);
    // Optionally, store the formatted version too:
    localStorage.setItem(`video-duration-formatted-${currentVideo.title}`, formatted);
  }
});
